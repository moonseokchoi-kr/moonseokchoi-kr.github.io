---
layout: post
title:  "[C++] 분할구현과 메모리"
summary: "분할구현과 메모리"
author: moon
date: '2021-05-13 12:35:23 +0900'
category: cpp
thumbnail: /assets/img/posts/bitoper.PNG
keywords: cpp, basic, variable, memory
permalink: /blog/cpp/basic/memory/
usemathjax: true
---

## 메모리와 변수

- 왜 알아야하는가
    - C++는 언어의 특정상 프로그래머가 메모리에 직접 접근이 가능하기때문에 이러한 구조를 모두 알고 프로그래밍을 해야할 필요가 있다. 그래야 제대로 된 사용이 가능하기 때문이다.
- 변수의 종류
    1. 지역변수
        - 함수내에 선언된 변수
        - 데이터 영역에 존재
    2. 전역변수
        - 함수밖에 선언된 변수
        - 데이터 영역에 존재
    3. 정적변수(static)
        - 선언방법
            - static (자료형) (변수명)
        - 전역변수와의 차이
            - 전역변수와 마찬가지로 데이터 영역의 존재
            - 정적변수는 전역변수와 달리 고정적이다.(위치가 변하지 않기 때문에 여러번 선언되도 독립적인 개체로 인식된다.)
            - 선언된 공간내에서 접근을 제한하기 때문에 안정적인 관리를 위해 사용된다(Singleton)
            - 함수 내에 선언하게 되면 초기화구문은 최초 1회만 실행된다.
    4. 외부변수(extern)
        - 선언방법
            - extern (자료형) (변수명)
            - 선언시 초기화하면 안된다.
            - 값을 저장하고 싶은곳에서 초기화
        - 다른변수들과의 차이
            - 프로그램내에서 완벽하게 공유되어 오직 하나의 값만을 갖게된다.
- 메모리 영역
    1. 스택 영역
        - 호출된 함수가 종료될때까지 저장하는 영역
        - 함수가 호출되면 메모리 할당
        - 함수가 종료되면 메모리가 해제된다.(결과값은 cpu 캐시메모리에 저장)
    2. 데이터 영역
        - 전역변수중 primitive 타입이나 static타입들이 저장되는 영역
        - 남발하면 프로그램 메모리가 감당안될정도로 커짐
        - 프로그램 시작시 생성
        - 프로그램 종료시 해제
    3. 읽기 전용(코드, ROM)
        - 프로그램을 이루는 코드나, 문자등이 모여있는 메모리 오직 읽을수만 있다.
    4. 힙 영역
        - malloc(),new등으로 선언된 변수가 할당되는 동적메모리 공간이다.
        - Instance가 소멸될때까지 계속 할당되어있다.
        - cpp는 GarbageCollector가 없기 때문에 프로그래머가 하나하나 다 소멸시켜줘야한다.

## 분할구현

- 헤더파일(.h)과 소스코드(.cpp)의 관계
    - 헤더파일은  함수나, 변수들의 선언을 정리하는 파일
    - 선언된 함수와 변수들은 링크단계에서 소스코드와 연결이된다.
    - 헤더파일 : 선언
    소스파일 : 구현
- 헤더파일에는 왜 구현을 하지 않을까?
    - 헤더파일에 구현을 하게될경우 include를 여러파일에서 할경우 재정의가 발생할수 있기 때문에
    - a.cpp, b.cpp c.cpp에서 더하기 함수를 구현까지해놓은 d.h을 include하면 3파일 모두에 add가 구현되어있는 상태 (코드가 중복된다.)
    - 그래서 중복적인 선언으로 컴파일 에러가 발생한다.
    - 이러한 문제를 방지하기 위해 header file에서 구현하지 않는다.
- 왜 사용할까?
    - 작은프로그램이라면 소스파일안에 모두 구현해도 유지보수나 가독성등이 문제가 없다
    - 하지만 큰 프로그램의 경우 한 파일안에 모두 작성하면 가독성이 떨어지고 유지보수 힘들다(가독성이 떨어지다보니 관계파악이힘듬)
    - 기능에 따라 헤더파일로 나누어 선언을하고 그에 맞게 구현을 하면 다음에 그 기능이 필요하면 헤더파일만 포함하는것으로 기능을 사용할 수 있다.
- 분할구현의 문제점
    - 전역변수가 무의미해짐
        - 어떤함수에서 사용하기 위해 선언해둔 전역변수를 분할하여 구성하게되면서 그 함수에 이용할 수 없게됨
    - 헤더파일에 전역변수를 선언하면 안되나?
        - 안된다. 결국 함수에서 발생하는 재정의 문제가 똑같이 발생한다.
    - 정적변수는 안되는 이유?
        - 정적은 선언영역을 해당파일에 고정되어있다는걸 알리는것이다. 즉 정적 변수 여러개를 여러파일에 선언하는것일뿐 외부에서 통합적인 변수로 사용 불가능(각각이 독립적)
    - 해결방법
        - extern 키워드를 이용해서 변수를 선언한다.
            - extern (자료형) (변수이름)
            - 선언시 절대 초기화를 하면 안된다
            - 나중에 따로 초기화를 진행해야한다.
            - 링크단계에서 extern으로 선언된 변수들을 링크시켜 외부파일에서 접근할 수 있도록 한다.
            - extern은 다른파일에서 이미 이름이 같은 전역변수가 선언이 되었다는 의미. 즉, 다른 파일간의 변수를 공유하고 있다라는 뜻
            - 초기화 위치는 아무파일이나 상관이 없다.