---
layout: post
title:  "[C++][WinAPI] Create Game Engine -18 Physics"
summary: "winapi game engine"
author: moon
date: '2021-08-03 12:35:23 +0900'
category: WinAPI
thumbnail: /assets/img/posts/bitoper.PNG
keywords: cpp, oop, winapi, ui, grapic,engine
permalink: /blog/cpp/winapi/engine/physics
usemathjax: true
---
## 2D Physics

---

- 모든 게임내 오브젝트들이 물리를 적용받는것이 아니기 때문에 상속구조를 이요하는 것이 적절치 않다
- 그렇기 때문에 물리를 적용받을 오브젝트에 추가하는 방식인 컴포넌트 형태로 구현한다.
- 힘을 이용하여 유도탄을 구현하는 예제를 보면, 힘은 가속도에 의해 결정되기 때문에 훨씬 현실적인 움직이 구현하다는 장점이있다.

## Rigid Body 구현

---

- 강체는 물리 구현을 위해. 질량이나 가속도 같은 정보를 가져야한다.
- 여기서 힘은 방향벡터로, 좌표의 의미가 아니다
- Rigid body를 생성한 물체들은 직접적인 좌표로 이동시키는게 아닌 힘으로 밀어 좌표를 바꿔야한다.
- 여기서도 잊으면 안되는건 무조건 시간동기화를 해줘야한다는것이다.

## 마찰력, 공기저항등의 구현

---

- 좀더 현실적인 움직임을 위해서는 마찰력이나, 공기저항등이 필수적인데, 실질적으로 이 모든걸 구현하는건 난이도가 매우 높다
- 원래는 힘이 주어질때도 마찰력이 계산되어야 물체 질량에 따라 움직임을 더 현실적으로 구현할 수 있게된다.(거대한 물체를 못믿다거나)
- 원래 마찰력은 운동마찰력이랑 최대정지 마찰력 2가지로 나누어 있는데, 현실적인 움직임을 위해서라면 둘다 구현을 해야한다.
- 마찰력은 언제나 내가 가는방향의 반대방향으로 작동하기 때문에 속도는 어느시점에서 더이상 증가하지 않게된다.

## 점프등 공중에서의 움직임을 위한 중력가속도 구현

---

- 지상에서 힘을 받아 공중으로 올라가게되면 바닥으로 다시 떨어지지 않음
- 바로 지상에서의 마찰력의 개념인 공기저항과, 중력가속도가 존재하지 않기 때문
- 또한 탑뷰나 쿼터뷰 시점의 개념은 구현이 조금 다른데, 탑뷰의 경우 오프셋을 조절하여 점프를 구현해야한다. 자신의 실제 좌표는 땅에 고정을 해놓고, 캐릭터의 모델링만 올라갔다 내려오는 식으로 구현이 되어야한다.
- 중력의 경우 상속기반을 중심으로 하게되면 골치아파지는 경우가 많기 때문에 컴포넌트구조로 선언을 하게된다.
- 따라서 중력에 적용될 물체에게만 붙여주는 방식으로 구현을 해주면 된다.
- 땅을 확인하긴위해서는 발바닥에 충돌체가 필요하다. 이를 위해 땅(Ground)클래스를 작성한다.
- 씬에서 설정한 크기를 콜라이더에도 적용시키고 싶다면, 씬시작시 값을 초기화시키는 함수를 작성하여 해주면된다.
- 중력계산의 문제점중 하나는 오브젝트가 땅을 파고 드는 문제가 있는데, 콜라이더간의 겹치는 영역 계산을 통해 인지 할 수 있다.
- 이 계산문제의 제일문제점은 바로 어떻게 겹쳤을까 이다. 어떻게 겹쳤을까를 생각해서 계산을 해야한다.
    - 예를 들어 그라운드보다 높게오면 착지, 낮게오면 옆으로 밀린다던가 이런 예외처리를 해야한다.

## 속도 제한 구현

---

- 마찰력이나 중력가속도를 적용받게 되면, 더이상 늘어날 수 없는 최대속도를 저장해야하는데 문제는 이 둘의 방향이 같지 않다는것이다.
- 그렇기때문에 최대속도는 방향정보를 가진 벡터로 구현되어, 힘과 방향 모두 표현이 되어야한다.
- 방향을 가지고 있기때문에 축별로 최대속도를 계산해줘야한다. 최대속도를 넘을 경우 축의 방향벡터만 구해서 최대속도값을 곱해 한쪽을 향하는 최대 속력값을 구한다.

## 점프

---

- 점프의 경우 처음에 속도를 지정해줘야 수월하게 구현하다. 점프의 유지시간동안 목표한 힘에 도달하지 못하기 때문에  처음속도를 일정량 지정을해줘야 부드럽게 전환이 된다.
- 점프의 경우 상당히 신경써야할게 많기 때문에 조건을 하나하나 잘 체크하고 분류해서 확인을 하는게 좋다.
- 예를들어 어떤행동을 공중에서 허용할껀지,