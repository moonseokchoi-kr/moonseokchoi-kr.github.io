<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8" /> <title> [C++][WinAPI] wMain 함수 해석 -MoonSeok Choi </title> <meta http-equip="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="description" content="object oriented programming- [C++][WinAPI] wMain 함수 해석"> <meta name="keywords" content="[C++][WinAPI] wMain 함수 해석, MoonSeok Choi, WinAPI,cpp, oop, winapi, ui, grapic"/> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" /> <meta content="" property="fb:app_id" /> <meta content="MoonSeok Choi" property="og:site_name" /> <meta content="[C++][WinAPI] wMain 함수 해석" property="og:title" /> <meta content="article" property="og:type" /> <meta content="object oriented programming" property="og:description" /> <meta content="/blog/data-structure/graph" property="og:url" /> <meta content="2021-06-21T03:35:23+00:00" property="article:published_time" /> <meta content="/about/" property="article:author" /> <meta content="/assets/img/posts/bitoper.PNG" property="og:image" /> <meta content="WinAPI" property="article:section" /> <!-- Twitter Cards --> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:title" content="[C++][WinAPI] wMain 함수 해석" /> <meta name="twitter:url" content="/blog/data-structure/graph" /> <meta name="twitter:description" content="object oriented programming" /> <link rel="stylesheet" href="/assets/css/main.css" /> <!-- <link rel="stylesheet" href="/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="/assets/bower_components/lightgallery/dist/css/lightgallery.min.css" /> <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css" /> <link rel="stylesheet" href="/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="/assets/bower_components/icono/dist/icono.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet" /> <!-- Favicon --> <link rel="icon" href="/assets/img/favicon.ico" type="image/gif" sizes="16x16" /> <script> var base_url = '' ; </script> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous" ></script> <!-- <script src="/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="/assets/bower_components/ghosthunter/dist/jquery.ghostHunter.min.js"></script> <script src="/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="/assets/js/search.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> <!-- for Mathjax support --> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } } }); </script> <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous" ></script> <!-- (you can remove the below scripts but do buy me a coffee to show some support :) --> <!-- Maker widget --> <script> (function(d, h, m) { var js, fjs = d.getElementsByTagName(h)[0]; if (d.getElementById(m)) { return; } js = d.createElement(h); js.id = m; js.onload = function() { window.makerWidgetComInit({ position: "left", widget: "ofeeof264otl2l5g-zspk40eq2gaomj2n-higi2qphmveubksi" }); }; js.src = "https://makerwidget.com/js/embed.js"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "dhm"); </script> <!-- buy me a coffeee --> <script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="sujaykundu" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FF813F" data-position="right" data-x_margin="10" data-y_margin="10" ></script> <!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]--> <!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> </head> <body> <nav class="navbar navbar-expand-lg fixed-top navbar-dark" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/">MoonSeok Choi</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="/" >Home</a > </li> <li class="nav-item"> <a class="nav-link" href="/about" >About</a > </li> <li class="nav-item"> <a class="nav-link" href="/blog" >Blog</a > </li> </ul> </div> <ul class="nav justify-content-end"> <li class="nav-item"> <a class="nav-link toggle-search-button" href="#search"> <i class="fa fa-search search-icon" aria-hidden="true"></i> </a> </li> <li class="nav-item" style="margin-top:5px; padding-right:20px;" > <a class="header__checkout snipcart-checkout"> <svg width="31" height="27" viewBox="0 0 31 27" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M1.10512 0.368718C0.560256 0.368718 0.118164 0.812066 0.118164 1.35848C0.118164 1.9049 0.560256 2.34824 1.10512 2.34824H4.90887L8.30138 18.4009C8.43503 19.0053 8.83085 19.5079 9.32946 19.5041H25.7788C26.3005 19.5118 26.7799 19.0375 26.7799 18.5143C26.7799 17.9911 26.3006 17.5168 25.7788 17.5245H10.1315L9.71003 15.545H27.095C27.5371 15.5412 27.9547 15.2048 28.0511 14.7718L30.354 4.87412C30.4825 4.29933 29.9852 3.67172 29.3979 3.66786H7.21171L6.6771 1.15221C6.58329 0.71276 6.15921 0.368652 5.7107 0.368652L1.10512 0.368718ZM7.623 5.64746H12.7634L13.2569 8.61674H8.25005L7.623 5.64746ZM14.7785 5.64746H20.9881L20.4946 8.61674H15.2719L14.7785 5.64746ZM23.0031 5.64746H28.1537L27.4649 8.61674H22.5097L23.0031 5.64746ZM8.67181 10.5963H13.5862L14.0797 13.5656H9.29919L8.67181 10.5963ZM15.6009 10.5963H20.1656L19.6721 13.5656H16.0944L15.6009 10.5963ZM22.1807 10.5963H27.0023L26.3135 13.5656H21.6872L22.1807 10.5963ZM12.6197 20.164C10.8141 20.164 9.32979 21.6525 9.32979 23.4632C9.32979 25.2739 10.8141 26.7624 12.6197 26.7624C14.4252 26.7624 15.9095 25.2739 15.9095 23.4632C15.9095 21.6525 14.4252 20.164 12.6197 20.164ZM22.4892 20.164C20.6837 20.164 19.1994 21.6525 19.1994 23.4632C19.1994 25.2739 20.6837 26.7624 22.4892 26.7624C24.2948 26.7624 25.7791 25.2739 25.7791 23.4632C25.7791 21.6525 24.2948 20.164 22.4892 20.164ZM12.6197 22.1435C13.3586 22.1435 13.9356 22.7222 13.9356 23.4632C13.9356 24.2042 13.3586 24.7829 12.6197 24.7829C11.8807 24.7829 11.3037 24.2042 11.3037 23.4632C11.3037 22.7222 11.8807 22.1435 12.6197 22.1435ZM22.4892 22.1435C23.2282 22.1435 23.8052 22.7222 23.8052 23.4632C23.8052 24.2042 23.2282 24.7829 22.4892 24.7829C21.7503 24.7829 21.1733 24.2042 21.1733 23.4632C21.1733 22.7222 21.7503 22.1435 22.4892 22.1435Z" fill="#ff7901" class="header__checkout-fill"></path> </svg> <span class="snipcart-items-count"></span> <!-- <span class="snipcart-total-price"></span> --> </a> </li> <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() " type="checkbox" name="checkbox" /> </li> </ul> </nav> <!-- Search Form --> <div class="search-form-container"> <form class="search-form"> <fieldset class="search-form__fieldset"> <div class="row"> <div class="col-lg-8 offset-md-2"> <input class="search-form__field" placeholder="Type to Search..." autofocus> <input class="search-form__submit" type="submit" value="search"> </div> </div> </fieldset> </form> <div class="row"> <div class="col-lg-8 offset-md-2 search-results"> <div class="card search-results"></div> </div> </div> <div class="close-search-button search-form-container__close"> <i class="fa fa-times icon"></i> </div> </div><div class="col-lg-12"> <div class="row" id="blog-post-container"> <div class="col-lg-8 offset-md-2"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">[C++][WinAPI] wMain 함수 해석</h1> <h4 class="post-meta">object oriented programming</h4> <p class="post-summary"> Posted by : <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name"><a href="/blog/authors/moon">moon</a></span> </span > at <time datetime="2021-06-21 03:35:23 +0000" itemprop="datePublished" >Jun 21, 2021</time > </p> <span class="disqus-comment-count" data-disqus-identifier="/blog/data-structure/graph" ></span> <div class="post-categories"> Category : <a href="/blog/categories/WinAPI" >WinAPI</a > </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="/assets/img/posts/bitoper.PNG" alt="" /> <br /> <br /> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define MAX_LOADSTRING 100
</span>
<span class="c1">// 전역 변수:</span>
<span class="n">HINSTANCE</span> <span class="n">hInst</span><span class="p">;</span>                                <span class="c1">// 현재 인스턴스입니다.</span>
<span class="n">WCHAR</span> <span class="n">szTitle</span><span class="p">[</span><span class="n">MAX_LOADSTRING</span><span class="p">];</span>                  <span class="c1">// 제목 표시줄 텍스트입니다.</span>
<span class="n">WCHAR</span> <span class="n">szWindowClass</span><span class="p">[</span><span class="n">MAX_LOADSTRING</span><span class="p">];</span>            <span class="c1">// 기본 창 클래스 이름입니다.</span>
</code></pre></div></div> <ul> <li>WCHAR <ul> <li>wchar_t의 이름을 재정의한것</li> </ul> </li> </ul> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 이 코드 모듈에 포함된 함수의 선언을 전달합니다:</span>
<span class="n">ATOM</span>                <span class="nf">MyRegisterClass</span><span class="p">(</span><span class="n">HINSTANCE</span> <span class="n">hInstance</span><span class="p">);</span>
<span class="n">BOOL</span>                <span class="nf">InitInstance</span><span class="p">(</span><span class="n">HINSTANCE</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="n">LRESULT</span> <span class="n">CALLBACK</span>    <span class="nf">WndProc</span><span class="p">(</span><span class="n">HWND</span><span class="p">,</span> <span class="n">UINT</span><span class="p">,</span> <span class="n">WPARAM</span><span class="p">,</span> <span class="n">LPARAM</span><span class="p">);</span>
<span class="n">INT_PTR</span> <span class="n">CALLBACK</span>    <span class="nf">About</span><span class="p">(</span><span class="n">HWND</span><span class="p">,</span> <span class="n">UINT</span><span class="p">,</span> <span class="n">WPARAM</span><span class="p">,</span> <span class="n">LPARAM</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">APIENTRY</span> <span class="nf">wWinMain</span><span class="p">(</span><span class="n">_In_</span> <span class="n">HINSTANCE</span> <span class="n">hInstance</span><span class="p">,</span>
                     <span class="n">_In_opt_</span> <span class="n">HINSTANCE</span> <span class="n">hPrevInstance</span><span class="p">,</span>
                     <span class="n">_In_</span> <span class="n">LPWSTR</span>    <span class="n">lpCmdLine</span><span class="p">,</span>
                     <span class="n">_In_</span> <span class="kt">int</span>       <span class="n">nCmdShow</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">UNREFERENCED_PARAMETER</span><span class="p">(</span><span class="n">hPrevInstance</span><span class="p">);</span>
    <span class="n">UNREFERENCED_PARAMETER</span><span class="p">(</span><span class="n">lpCmdLine</span><span class="p">);</span>

    <span class="c1">// TODO: 여기에 코드를 입력합니다.</span>

    <span class="c1">// 전역 문자열을 초기화합니다.</span>
    <span class="n">LoadStringW</span><span class="p">(</span><span class="n">hInstance</span><span class="p">,</span> <span class="n">IDS_APP_TITLE</span><span class="p">,</span> <span class="n">szTitle</span><span class="p">,</span> <span class="n">MAX_LOADSTRING</span><span class="p">);</span>
    <span class="n">LoadStringW</span><span class="p">(</span><span class="n">hInstance</span><span class="p">,</span> <span class="n">IDC_CLIENT</span><span class="p">,</span> <span class="n">szWindowClass</span><span class="p">,</span> <span class="n">MAX_LOADSTRING</span><span class="p">);</span>
    <span class="n">MyRegisterClass</span><span class="p">(</span><span class="n">hInstance</span><span class="p">);</span>

    <span class="c1">// 애플리케이션 초기화를 수행합니다:</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">InitInstance</span> <span class="p">(</span><span class="n">hInstance</span><span class="p">,</span> <span class="n">nCmdShow</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">BOOL</span> <span class="nf">InitInstance</span><span class="p">(</span><span class="n">HINSTANCE</span> <span class="n">hInstance</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nCmdShow</span><span class="p">)</span>
<span class="p">{</span>
   <span class="n">hInst</span> <span class="o">=</span> <span class="n">hInstance</span><span class="p">;</span> <span class="c1">// 인스턴스 핸들을 전역 변수에 저장합니다.</span>

   <span class="n">HWND</span> <span class="n">hWnd</span> <span class="o">=</span> <span class="n">CreateWindowW</span><span class="p">(</span><span class="n">szWindowClass</span><span class="p">,</span> <span class="n">szTitle</span><span class="p">,</span> <span class="n">WS_OVERLAPPEDWINDOW</span><span class="p">,</span>
      <span class="n">CW_USEDEFAULT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">CW_USEDEFAULT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">nullptr</span><span class="p">,</span> <span class="nb">nullptr</span><span class="p">,</span> <span class="n">hInstance</span><span class="p">,</span> <span class="nb">nullptr</span><span class="p">);</span>

   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hWnd</span><span class="p">)</span>
   <span class="p">{</span>
      <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="n">ShowWindow</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">nCmdShow</span><span class="p">);</span>
   <span class="n">UpdateWindow</span><span class="p">(</span><span class="n">hWnd</span><span class="p">);</span>

   <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div> <ul> <li>hInstance <ul> <li>실행된 프로그램의 메모리주소를 의미한다.</li> <li>새로운 창을 생성하기 위한 정보를 입력받는 구조체</li> <li>메인함수에서 지역변수로 입력받아, 초기화 함수를 거쳐 초기화가 된다.</li> <li>hPrevInstance는 과거 windows를 위해 필요한 파라미터이나, 지금은 필요가 없다.</li> </ul> </li> <li>IpCmdLine <ul> <li>wchar_t pointer (LPWSTR)타입으로 명령창을 이용해 문자열을 표시할 경우 사용</li> </ul> </li> <li>LoadStringW <ul> <li>사용할 리소스를 테이블에서 가져와 문자열을 초기화하는 함수</li> <li>2번째 파라미터로 가져올 리소스의 ID를 전달받는다.(resource.h에 전처리기로 설정 되어있다.)</li> </ul> </li> <li>MyRegisterClass <ul> <li>윈도우(프로그램 창)을 설정하는 함수</li> <li>내부에서 윈도우를 설정하는 구조체를 작성</li> </ul> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">ATOM</span> <span class="nf">MyRegisterClass</span><span class="p">(</span><span class="n">HINSTANCE</span> <span class="n">hInstance</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="n">WNDCLASSEXW</span> <span class="n">wcex</span><span class="p">;</span>

      <span class="n">wcex</span><span class="p">.</span><span class="n">cbSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">WNDCLASSEX</span><span class="p">);</span>

      <span class="n">wcex</span><span class="p">.</span><span class="n">style</span>          <span class="o">=</span> <span class="n">CS_HREDRAW</span> <span class="o">|</span> <span class="n">CS_VREDRAW</span><span class="p">;</span>
      <span class="n">wcex</span><span class="p">.</span><span class="n">lpfnWndProc</span>    <span class="o">=</span> <span class="n">WndProc</span><span class="p">;</span>
      <span class="n">wcex</span><span class="p">.</span><span class="n">cbClsExtra</span>     <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">wcex</span><span class="p">.</span><span class="n">cbWndExtra</span>     <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">wcex</span><span class="p">.</span><span class="n">hInstance</span>      <span class="o">=</span> <span class="n">hInstance</span><span class="p">;</span>
      <span class="n">wcex</span><span class="p">.</span><span class="n">hIcon</span>          <span class="o">=</span> <span class="n">LoadIcon</span><span class="p">(</span><span class="n">hInstance</span><span class="p">,</span> <span class="n">MAKEINTRESOURCE</span><span class="p">(</span><span class="n">IDI_CLIENT</span><span class="p">));</span>
      <span class="n">wcex</span><span class="p">.</span><span class="n">hCursor</span>        <span class="o">=</span> <span class="n">LoadCursor</span><span class="p">(</span><span class="nb">nullptr</span><span class="p">,</span> <span class="n">IDC_ARROW</span><span class="p">);</span>
      <span class="n">wcex</span><span class="p">.</span><span class="n">hbrBackground</span>  <span class="o">=</span> <span class="p">(</span><span class="n">HBRUSH</span><span class="p">)(</span><span class="n">COLOR_WINDOW</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
      <span class="n">wcex</span><span class="p">.</span><span class="n">lpszMenuName</span>   <span class="o">=</span> <span class="n">MAKEINTRESOURCEW</span><span class="p">(</span><span class="n">IDC_CLIENT</span><span class="p">);</span>
      <span class="n">wcex</span><span class="p">.</span><span class="n">lpszClassName</span>  <span class="o">=</span> <span class="n">szWindowClass</span><span class="p">;</span>
      <span class="n">wcex</span><span class="p">.</span><span class="n">hIconSm</span>        <span class="o">=</span> <span class="n">LoadIcon</span><span class="p">(</span><span class="n">wcex</span><span class="p">.</span><span class="n">hInstance</span><span class="p">,</span> <span class="n">MAKEINTRESOURCE</span><span class="p">(</span><span class="n">IDI_SMALL</span><span class="p">));</span>

      <span class="k">return</span> <span class="n">RegisterClassExW</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wcex</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre></div> </div> </li> <li>InitInstance <ul> <li>윈도우를 생성하는함수 앞써 생성한 창의 정보를 기반으로 윈도우를 생성</li> <li>창은 프로세스이나, 모든 프로세스가 창은 아니다(백그라운드에서 실행되는 프로세스도 있다.)</li> </ul> </li> <li>주석문법(<em>In</em>, <em>In_opt</em>) <ul> <li>특수한 주석으로 파라미터가 어떻게 사용될지를 알려준다.</li> <li> <p>상세내용</p> <p><a href="https://docs.microsoft.com/ko-kr/cpp/c-runtime-library/sal-annotations?view=msvc-160">SAL 주석</a></p> </li> </ul> </li> </ul> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//단축키 테이블 정보</span>
<span class="n">HACCEL</span> <span class="n">hAccelTable</span> <span class="o">=</span> <span class="n">LoadAccelerators</span><span class="p">(</span><span class="n">hInstance</span><span class="p">,</span> <span class="n">MAKEINTRESOURCE</span><span class="p">(</span><span class="n">IDC_CLIENT</span><span class="p">));</span>

<span class="n">MSG</span> <span class="n">msg</span><span class="p">;</span>

<span class="c1">// GetMessage의 특징</span>
<span class="c1">// 메세지 큐에서 메세지가 없으면 메세지가 확인될때까지 대기한다.(종료되지않는다)</span>
<span class="c1">//</span>
<span class="k">while</span> <span class="p">(</span><span class="n">GetMessage</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span> <span class="nb">nullptr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">TranslateAccelerator</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">hwnd</span><span class="p">,</span> <span class="n">hAccelTable</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">))</span>
   <span class="p">{</span>
	     <span class="n">TranslateMessage</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">);</span>
	     <span class="n">DispatchMessage</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">msg</span><span class="p">.</span><span class="n">wParam</span><span class="p">;</span>
</code></pre></div></div> <ul> <li>메시지방식을 통해 윈도우에서 발생한 이벤트들을 처리한다.</li> <li>운영체제에는 메세지큐라는게 존재하는데 메세지를 차례대로 저장하여 FIFO방식으로 출력한다.</li> <li>프로그램은 그 메시지내에 속한 handle이 자신인것만 가져와 차례대로 처리한다.</li> <li>이벤트는 루프를 통해서 처리하는데 프로그램 종료 이벤트가 들어올떄까지 무한히 반복한다.</li> </ul> <h3 id="window-procissor">window procissor</h3> <hr /> <ul> <li>콜백 형태로 호출되는 메세지 처리 함수</li> <li>메시지별로 case를 나누어 처리를 할 수 있도록 만들어져 있다</li> <li>사용자가 처리하지 않을 메시지들은 DefWindowProc라는 함수를 호출해 처리하게 해줄 수 있다.</li> </ul> <h2 id="윈도우-좌표">윈도우 좌표</h2> <hr /> <ul> <li>윈도우의 작업영역내에서 위치를 표현한다.</li> <li>단위는 픽셀을 사용한다.</li> </ul> <h2 id="window-객체">Window 객체</h2> <hr /> <ul> <li>CreateWindow를 통해 생성되는 윈도우 객체는 운영체제에서 관리하는 객체이기 때문에 프로그래머가 직접 내용을 확인하거나 수정을 할 수 가 없다.</li> <li>운영체제에서 관리되는 객체는 ID를 프로그래머에게 제공해주어서 ID를 통해 핸들링을 할 수 있도록 한다.</li> <li>윈도우에서 제공하는 기본적은 함수에 handle구조체를 넘겨주어 컨트롤하는 방식이다.</li> </ul> <h2 id="윈도우-프로시저-핸들">윈도우 프로시저 핸들</h2> <hr /> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LRESULT</span> <span class="n">CALLBACK</span> <span class="nf">WndProc</span><span class="p">(</span><span class="n">HWND</span> <span class="n">hWnd</span><span class="p">,</span> <span class="n">UINT</span> <span class="n">message</span><span class="p">,</span> <span class="n">WPARAM</span> <span class="n">wParam</span><span class="p">,</span> <span class="n">LPARAM</span> <span class="n">lParam</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="n">WM_COMMAND</span><span class="p">:</span>
        <span class="p">{</span>
            <span class="kt">int</span> <span class="n">wmId</span> <span class="o">=</span> <span class="n">LOWORD</span><span class="p">(</span><span class="n">wParam</span><span class="p">);</span>
            <span class="c1">// 메뉴 선택을 구문 분석합니다:</span>
            <span class="k">switch</span> <span class="p">(</span><span class="n">wmId</span><span class="p">)</span>
            <span class="p">{</span>
            <span class="k">case</span> <span class="n">IDM_ABOUT</span><span class="p">:</span>
                <span class="n">DialogBox</span><span class="p">(</span><span class="n">hInst</span><span class="p">,</span> <span class="n">MAKEINTRESOURCE</span><span class="p">(</span><span class="n">IDD_ABOUTBOX</span><span class="p">),</span> <span class="n">hWnd</span><span class="p">,</span> <span class="n">About</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="n">IDM_EXIT</span><span class="p">:</span>
                <span class="n">DestroyWindow</span><span class="p">(</span><span class="n">hWnd</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="nl">default:</span>
                <span class="k">return</span> <span class="n">DefWindowProc</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">wParam</span><span class="p">,</span> <span class="n">lParam</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="n">WM_PAINT</span><span class="p">:</span>
        <span class="p">{</span>
            <span class="n">PAINTSTRUCT</span> <span class="n">ps</span><span class="p">;</span>
            <span class="n">HDC</span> <span class="n">hdc</span> <span class="o">=</span> <span class="n">BeginPaint</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ps</span><span class="p">);</span><span class="c1">//Device Context (그리기)</span>

            <span class="n">Rectangle</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">110</span><span class="p">);</span>

            <span class="n">EndPaint</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ps</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="n">WM_DESTROY</span><span class="p">:</span>
        <span class="n">PostQuitMessage</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="nl">default:</span>
        <span class="k">return</span> <span class="n">DefWindowProc</span><span class="p">(</span><span class="n">hWnd</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">wParam</span><span class="p">,</span> <span class="n">lParam</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <ul> <li>WM_COMMAND는 창의 메뉴를 선택할때 호출된다.(파일, 메뉴등..)</li> <li>WM_KEYDOWN은 키보드가 눌렸을때 이벤트를 담당한다. <ul> <li>VK_xxxx를 통해 화살표나, 시프트, 컨트롤등의 이벤트를 처리한다.</li> <li>영어자판의경우 아스키코드를 통해 가져올수 있다.</li> <li> <p>예</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">case</span> <span class="n">WM_KEYDOWN</span><span class="p">:</span>
      <span class="p">{</span>
          <span class="k">switch</span> <span class="p">(</span><span class="n">wParam</span><span class="p">)</span>
          <span class="p">{</span>
          <span class="k">case</span> <span class="n">VK_UP</span><span class="p">:</span>
  		<span class="p">{</span>
  			<span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  		<span class="p">}</span>
              <span class="k">break</span><span class="p">;</span>
          <span class="k">case</span> <span class="sc">'D'</span><span class="p">:</span>
          <span class="p">{</span>
              <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="p">}</span>
              <span class="k">break</span><span class="p">;</span>
          <span class="nl">default:</span>
              <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span>
      <span class="p">}</span>
          <span class="k">break</span><span class="p">;</span>
</code></pre></div> </div> </li> </ul> </li> <li>WM_L or R MOUSE_BUTTON을 통해 마우스 입력도 가져올수있다. <ul> <li>lParam변수에는 각각 2byte씩 마우스의 클릭좌표로 가져올수 있다.</li> <li>LOWORD(),HIWORD()를 통해 각각 x와 y좌표를 가져올수 있다.</li> </ul> </li> <li>WM__PAINT이벤트가 호출되면 화면을 그린다.</li> <li>WM_PAINT는 무효화영역이 발생되었을때 호출된다.</li> <li>무효화영역이 대표적으로 생기는 경우는 창을 내렸다. 다시 활성화했을때이다 <ul> <li>내부적으로 이미지데이터를 가지고 있기때문에 예전처럼 창이 가려진것으로 무효화영역이 발생하지 않는다.</li> </ul> </li> <li>각각의 handle 구조체들은 정수타입의 변수로 운영체제로 부터 id를 받게된다. <ul> <li>왜 구조체들이 구분되어있을까? <ul> <li>id만을 받지만, 각 id가 어떤것을 다룰지, 운영체제는 단순히 숫자만 알려주기 때문에 사용자 입장에서 그걸 구분할 수 가 없다.</li> <li>따라서 사용자의 편의와 잘못된 사용을 방지하기위해 구조체로 구분하여 제공한다.</li> </ul> </li> <li>Device Context? <ul> <li>화면에 렌더링을 수행하는데 필요한 Data집합(DirectX할때도 나오는 개념)</li> <li>어디에 그릴지, 어떻게 그릴지에 대한 정보를 가지고 있다.</li> <li>그렇기 때문에 생성시 현재 window정보와, paintstruct정보를 받아서 생성된다.</li> </ul> </li> <li>GetStockObject() <ul> <li>GDI에서 자주사용하는 펜이나 브러시를 미리 생성해놓았는데, 이걸 가져오는 함수</li> <li>MSDN에서 목록을 확인 할 수 있다.</li> <li>대표적으로 HOLLOW Brush(투명 브러쉬)를 사용할때 이용한다.</li> </ul> </li> <li> <p>Device Context예제 - 펜설정하기&amp; 브러쉬설정하기</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  			<span class="c1">//펜을 만들어 device context를 지급</span>
              <span class="n">HPEN</span> <span class="n">hPen</span> <span class="o">=</span> <span class="n">CreatePen</span><span class="p">(</span><span class="n">PS_SOLID</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">));</span>
              <span class="n">HBRUSH</span> <span class="n">hBrush</span> <span class="o">=</span> <span class="n">CreateSolidBrush</span><span class="p">(</span><span class="n">RGB</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">));</span>

              <span class="c1">//void포인터로 반환해 필요한 타입으로 캐스팅</span>
              <span class="n">HPEN</span> <span class="n">hDefalutPen</span> <span class="o">=</span> <span class="p">(</span><span class="n">HPEN</span><span class="p">)</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="n">hPen</span><span class="p">);</span>
              <span class="n">HBRUSH</span> <span class="n">hDefaultBrush</span> <span class="o">=</span> <span class="p">(</span><span class="n">HBRUSH</span><span class="p">)</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="n">hBrush</span><span class="p">);</span>

              <span class="n">Rectangle</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">110</span><span class="p">);</span>

              <span class="n">SelectObject</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="n">hDefalutPen</span><span class="p">);</span>
              <span class="n">SelectObject</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="n">hDefaultBrush</span><span class="p">);</span>
              <span class="c1">//필요없는 오브젝트 삭제</span>
              <span class="n">DeleteObject</span><span class="p">(</span><span class="n">hDefaultBrush</span><span class="p">);</span>
              <span class="n">DeleteObject</span><span class="p">(</span><span class="n">hPen</span><span class="p">);</span>
</code></pre></div> </div> </li> </ul> </li> </ul> <br /><!-- Load Facebook SDK for JavaScript --> <div id="fb-root"></div> <script> (function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "facebook-jssdk"); </script> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8" ></script> <div class="share-page"> <p class="share-text">Share this on &rarr;</p> <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-show-count="false" style="margin-top:5px;" >Tweet</a > <a class="fb-share-button" data-href="/blog/data-structure/graph" data-size="large" data-layout="button" >Share</a> </div><!-- Author box --> <div class="card"> <div class="card-header"> About Choi MoonSeok </div> <div class="card-body"> <div class="row"> <div class="col-md-4"> <img class="author-profile-img" src="/assets/img/authors/johndoe.png" alt="Choi MoonSeok" /> </div> <div class="col-md-6"> <p class="author_bio">안녕하세요, 최문석입니다 그래픽프로그래머와 게임개발에 관심이 있습니다</p> <p>Email : moonseoktech@gmail.com</p> <p>Website : https://moonseokchoi-kr.github.io</p> <p class="profile-links"> <a class="social-link" href="https://github.com/moonseokchoi-kr" target="_blank"><i class="fab fa-github fa-fw"></i></a> </p> </div> </div> </div> </div> </div><!-- Incomment incase you want to use Disqus <div id="disqus_thread"></div> --> </article> <script> var disqus_config = function () { this.page.url = "/blog/data-structure/graph"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/blog/data-structure/winapi-basic-main"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">About moon</div> <div class="card-body"> <p class="author_bio">안녕하세요 꾸준한 개발자가 되고싶은 최문석입니다.</p><!-- Place this tag where you want the github button to render. --> <a class="github-button" href="https://github.com/sujaykundu777/devlopr-jekyll" data-color-scheme="no-preference: dark; light: dark; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star sujaykundu777/devlopr-jekyll on GitHub">Star</a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories</div> <div class="card-body text-dark"> <div id="#cpp"></div> <li class="tag-head"> <a href="/blog/categories/cpp">cpp</a> </li> <a name="cpp"></a> <div id="#data_structure"></div> <li class="tag-head"> <a href="/blog/categories/data_structure">data_structure</a> </li> <a name="data_structure"></a> <div id="#WinAPI"></div> <li class="tag-head"> <a href="/blog/categories/WinAPI">WinAPI</a> </li> <a name="WinAPI"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links</div> <div class="card-body text-dark"> <li> <a href="/">Home</a> </li> <li> <a href="/about">About</a> </li> <li> <a href="/blog">Blog</a> </li> </div> </div> </div> </div> </div> <div class="col-lg-12" id="newsletter_footer"><!-- Mailchimp Newletters --> <form action=""method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate> <div id="mc_embed_signup_scroll_footer"> <label for="mce-EMAIL_footer"> Signup for Weekly Email Newsletters :D</label> <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL_footer" placeholder="email address" required> <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--> <div style="position: absolute; left: -5000px;" aria-hidden="true"> <input type="text" name="b_50bab1c85eae24ecfb0f68361_3a2dd721d0" tabindex="-1" value=""> </div><br /> <div class="clear"> <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe_footer" class="btn btn-lg btn-success"> </div> </div> </div><footer> <p> Powered by<a href="https://github.com/sujaykundu777/devlopr-jekyll"> devlopr jekyll</a>.Hosted at <a href="https://pages.github.com">Github</a>. Subscribe via <a href=" /feed.xml ">RSS</a> </p> </footer> <script> var options = { classname: 'my-class', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> <script src="/assets/js/mode-switcher.js"></script> <script> if (window.netlifyIdentity) { window.netlifyIdentity.on("init", user => { if (!user) { window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; }); } }); } </script> </body> </html>
